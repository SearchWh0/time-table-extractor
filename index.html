<!DOCTYPE html>
<html>
<head>

<title>Timetable Extractor v2</title>

<script src="https://cdn.jsdelivr.net/npm/tesseract.js@4/dist/tesseract.min.js"></script>

</head>

<body>

<h2>Upload OR Paste Image</h2>

<input type="file" id="upload">

<p>OR press Ctrl+V to paste</p>

<canvas id="canvas" style="border:1px solid black;"></canvas>

<br><br>

Selected Colour:

<input type="color" id="picker">

<span id="status">None</span>

<br><br>

<button onclick="extract()">Extract Text</button>

<br><br>

<textarea id="output" rows="20" cols="80"></textarea>

<script>

let canvas = document.getElementById("canvas");
let ctx = canvas.getContext("2d");

let selectedColor = null;



// LOAD IMAGE

function loadImage(src){

let img = new Image();

img.onload = function(){

canvas.width = img.width;
canvas.height = img.height;

ctx.drawImage(img,0,0);

}

img.src = src;

}



// FILE UPLOAD

upload.onchange = function(e){

loadImage(URL.createObjectURL(e.target.files[0]));

}



// PASTE

document.addEventListener("paste", function(e){

for (let item of e.clipboardData.items){

if(item.type.includes("image")){

loadImage(URL.createObjectURL(item.getAsFile()));

}

}

});




// PICK COLOUR

canvas.addEventListener("click", function(e){

let pixel = ctx.getImageData(e.offsetX, e.offsetY,1,1).data;

selectedColor = {

r:pixel[0],
g:pixel[1],
b:pixel[2]

};

let hex = "#"+
((1<<24)+(pixel[0]<<16)+(pixel[1]<<8)+pixel[2])
.toString(16).slice(1);

picker.value=hex;

status.innerHTML="Selected: "+hex;

});




// EXTRACT

function extract(){

if(selectedColor===null){

alert("Select a colour first");

return;

}


// create copy

let imgData = ctx.getImageData(0,0,canvas.width,canvas.height);

let data = imgData.data;


for(let i=0;i<data.length;i+=4){

let diff=

Math.abs(data[i]-selectedColor.r)+
Math.abs(data[i+1]-selectedColor.g)+
Math.abs(data[i+2]-selectedColor.b);


if(diff<150){

data[i]=0;
data[i+1]=0;
data[i+2]=0;

}else{

data[i]=255;
data[i+1]=255;
data[i+2]=255;

}

}


let tempCanvas=document.createElement("canvas");

tempCanvas.width=canvas.width;
tempCanvas.height=canvas.height;

let tempCtx=tempCanvas.getContext("2d");

tempCtx.putImageData(imgData,0,0);



// OCR

Tesseract.recognize(

tempCanvas,

"eng"

).then(result=>{

output.value=result.data.text;

});


}

</script>

</body>

</html>
