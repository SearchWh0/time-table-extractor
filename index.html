<!DOCTYPE html>
<html>
<head>

<title>Timetable Extractor v3</title>

<script src="https://cdn.jsdelivr.net/npm/tesseract.js@4/dist/tesseract.min.js"></script>

</head>

<body>

<h2>Upload OR Paste Image</h2>

<input type="file" id="upload">

<p>OR press Ctrl+V</p>

<canvas id="canvas" style="border:1px solid black; max-width:100%; height:auto;"></canvas>

<br><br>

Selected Colour:

<input type="color" id="picker">

<span id="status">None</span>

<br><br>

<button onclick="extract()">Extract Text</button>

<br><br>

<textarea id="output" rows="20" cols="80"></textarea>


<script>

let canvas = document.getElementById("canvas");

let ctx = canvas.getContext("2d");

let selectedColor = null;



function loadImage(src){

let img = new Image();

img.onload = function(){

canvas.width = img.width;
canvas.height = img.height;

ctx.drawImage(img,0,0);

}

img.src = src;

}



// upload

upload.onchange = e =>
loadImage(URL.createObjectURL(e.target.files[0]));



// paste

document.addEventListener("paste", function(e){

for(let item of e.clipboardData.items){

if(item.type.includes("image")){

loadImage(URL.createObjectURL(item.getAsFile()));

}

}

});




// FIXED CLICK DETECTION

canvas.addEventListener("click", function(e){

let rect = canvas.getBoundingClientRect();

let scaleX = canvas.width / rect.width;
let scaleY = canvas.height / rect.height;

let x = Math.floor((e.clientX - rect.left) * scaleX);
let y = Math.floor((e.clientY - rect.top) * scaleY);

let pixel = ctx.getImageData(x,y,1,1).data;

selectedColor = pixel;

let hex =
"#"+
((1<<24)+(pixel[0]<<16)+(pixel[1]<<8)+pixel[2])
.toString(16)
.slice(1);

picker.value = hex;

document.getElementById("status").innerHTML =
"Selected: "+hex;

});




// extract

function extract(){

if(!selectedColor){

alert("Select a colour first");

return;

}

output.value="Processing...";


Tesseract.recognize(canvas,"eng")

.then(result=>{

output.value=result.data.text;

});

}


</script>

</body>

</html>
